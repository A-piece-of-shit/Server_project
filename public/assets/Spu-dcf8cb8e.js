import{af as L,d as X,r as c,aD as _e,o as m,D as A,e as t,b as e,c as B,H as R,G as T,f as E,ax as ge,A as W,g as U,J as le,m as C,q as se,s as ne,aE as ue,aF as oe,L as ve,aq as Se,an as be,t as Y,ag as Z,aC as ke,ai as ee,x as ie,a as ye,au as Ie,as as Ve,ae as Ae,at as Ue,w as J,P as Q,aB as Ce,F as Le,ah as De,aj as he,ak as Ne,ad as Pe}from"./index-875aa0db.js";/* empty css                      *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                    *//* empty css                */const $e=(f,_,b)=>L.get(`spu/get/${f}/${_}/${b}`),ae=()=>L.get("spu/get/brand"),de=f=>L.get(`spu/get/brandimg/${f}`),re=f=>L.get(`spu/get/saleslist/${f}`),te=()=>L.get("spu/get/salesattrlist/"),Ee=f=>f.id?L.post("spu/edit",f):L.post("spu/add",f),we=f=>L.post("spu/add/sku",f),xe=f=>L.get(`spu/get/sku/${f}`),qe=f=>L.get(`spu/delete/${f}`),Be=["src"],ze=X({__name:"EditSpu",emits:["administrativeNameChange"],setup(f,{expose:_,emit:b}){const y="http://127.0.0.1:3000/development",j=()=>{b("administrativeNameChange","","update")},u=c({spuName:"",description:"",classification3Id:"",brandId:"",salexInformationList:[],imageInformationList:[]}),D=c([]),k=c([]),n=c([]),z=c([]),w=async a=>{u.value=a;const l=await ae();D.value=l.data;const S=await de(a.id);console.log(S),k.value=S.data.map(O=>({name:O.imgName,url:y+"/"+O.imgUrl}));const I=await re(a.id);n.value=I.data;const P=await te();z.value=P.data},h=c(!1),x=c(""),V=a=>{x.value=a.url,h.value=!0},d=a=>{x.value=a.data,k.value[k.value.length-1].Url=a.data},p=a=>a.type==="image/png"||a.type==="image/jpeg"||a.type==="image/gif"||a.type==="image/jpg"?a.size/1024/1024<4?!0:(C({type:"error",message:"上传失败"}),!1):(C({type:"error",message:"上传失败"}),!1),o=_e(()=>z.value.filter(a=>n.value.every(l=>a.name!==l.attrName))),g=c(""),q=()=>{const[a,l]=g.value.split(":");n.value.push({attrId:+a,attrName:l,spuSalesListAttrValueList:[]}),g.value=""},N=a=>{a.flag=!0,a.attrValue=""},i=a=>{a.flag=!1;const{attrValue:l,attrId:S,attrName:I}=a;if(l.trim()===""){C({type:"warning",message:"输入内容不能为空！！！"});return}if(a.spuSalesListAttrValueList||(a.spuSalesListAttrValueList=[]),a.spuSalesListAttrValueList.every(P=>P.valueName!==a.attrValue)===!1){C({type:"warning",message:"输入内容重复！！！"});return}console.log(a.spuSalesListAttrValueList),a.spuSalesListAttrValueList.push({attrName:I,attrId:S,valueName:l})},r=async()=>{u.value.imageInformationList=k.value.map(l=>({imgName:l.name,imgUrl:l.Url||l.url})),u.value.salexInformationList=n.value,(await Ee(u.value)).code===200?(C({type:"success",message:u.value.id?"更新成功":"添加成功"}),b("administrativeNameChange","",u.value.id?"update":"add")):C({type:"success",message:u.value.id?"更新失败":"添加失败"})};return _({initUpdateSpuData:w,initAddSpuData:async a=>{Object.assign(u.value,{spuName:"",description:"",classification3Id:"",brandId:"",salexInformationList:[],imageInformationList:[]}),k.value=[],n.value=[],g.value="",u.value.classification3Id=a;const l=await ae();D.value=l.data;const S=await te();z.value=S.data}}),(a,l)=>{const S=se,I=ne,P=ue,O=oe,F=ve,H=Se,v=be,$=Y,G=Z,pe=ke,ce=ee,me=ie;return m(),A(me,{"label-width":"100"},{default:t(()=>[e(I,{label:"SPU名称"},{default:t(()=>[e(S,{placeholder:"请您输入SPU名称",modelValue:u.value.spuName,"onUpdate:modelValue":l[0]||(l[0]=s=>u.value.spuName=s)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU品牌"},{default:t(()=>[e(O,{modelValue:u.value.brandId,"onUpdate:modelValue":l[1]||(l[1]=s=>u.value.brandId=s)},{default:t(()=>[(m(!0),B(R,null,T(D.value,s=>(m(),A(P,{key:s.id,label:s.brandName,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU描述"},{default:t(()=>[e(S,{type:"textarea",placeholder:"请您输入SPU描述",modelValue:u.value.description,"onUpdate:modelValue":l[2]||(l[2]=s=>u.value.description=s)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU照片"},{default:t(()=>[e(H,{"file-list":k.value,"onUpdate:fileList":l[3]||(l[3]=s=>k.value=s),action:E(y)+"/spu/upload/brandimg","list-type":"picture-card","on-preview":V,"on-success":d,"before-upload":p},{default:t(()=>[e(F,null,{default:t(()=>[e(E(ge))]),_:1})]),_:1},8,["file-list","action"]),e(v,{modelValue:h.value,"onUpdate:modelValue":l[4]||(l[4]=s=>h.value=s)},{default:t(()=>[W("img",{"w-full":"",src:x.value,alt:"Preview Image",style:{width:"100%"}},null,8,Be)]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU销售属性"},{default:t(()=>[e(O,{placeholder:E(o).length?"请选择":"无",modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=s=>g.value=s)},{default:t(()=>[(m(!0),B(R,null,T(E(o),s=>(m(),A(P,{key:s.id,label:s.name,value:`${s.id}:${s.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e($,{onClick:q,style:{"margin-left":"2vw"},disabled:E(o).length===0||!g.value},{default:t(()=>[U("添加属性值")]),_:1},8,["disabled"]),e(ce,{border:"",style:{"margin-top":"3vh"},data:n.value},{default:t(()=>[e(G,{label:"序号",type:"index",align:"center",width:"80"}),e(G,{label:"销售属性名字",prop:"attrName"}),e(G,{label:"销售属性值"},{default:t(({row:s})=>[(m(!0),B(R,null,T(s.spuSalesListAttrValueList,(K,fe)=>(m(),A(pe,{key:K.id,class:"mx-1",closable:"","disable-transitions":!1,onClose:Te=>s.spuSalesListAttrValueList.splice(fe,1),style:{"margin-right":"1vw"}},{default:t(()=>[U(le(K.valueName),1)]),_:2},1032,["onClose"]))),128)),s.flag?(m(),A(S,{key:0,ref:"InputRef",modelValue:s.attrValue,"onUpdate:modelValue":K=>s.attrValue=K,class:"ml-1 w-20",size:"small",onBlur:K=>i(s)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(m(),A($,{key:1,class:"button-new-tag ml-1",size:"small",onClick:K=>N(s)},{default:t(()=>[U(" + New Tag ")]),_:2},1032,["onClick"]))]),_:1}),e(G,{label:"操作"},{default:t(({$index:s})=>[e($,{type:"primary",size:"small",onClick:K=>n.value.splice(s,1)},{default:t(()=>[U("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(I,null,{default:t(()=>[e($,{type:"primary",onClick:r},{default:t(()=>[U("保存")]),_:1}),e($,{type:"primary",onClick:j},{default:t(()=>[U("取消")]),_:1})]),_:1})]),_:1})}}}),Oe=["src"],Ke=X({__name:"EditSku",emits:["administrativeNameChange"],setup(f,{expose:_,emit:b}){const y="http://127.0.0.1:3000/development",j=()=>{b("administrativeNameChange","","update")},u=c([]),D=c([]),k=c([]),n=ye({classification3Id:"",spuId:"",brandId:"",skuName:"",skuPrice:"",skuWeight:"",skuDesc:"",skuPlatformAttrList:[],skuSalesAttrList:[],skuImgUrl:""}),z=async(V,d,p)=>{Object.assign(n,{classification3Id:"",spuId:"",brandId:"",skuName:"",skuPrice:"",skuWeight:"",skuDesc:"",skuPlatformAttrList:[],skuSalesAttrList:[],skuImgUrl:""}),n.classification3Id=p.classification3Id,n.spuId=p.id,n.brandId=p.brandId;const o=await Ie(V,d,p.classification3Id);u.value=o.data;const g=await de(p.id);k.value=g.data;const q=await re(p.id);D.value=q.data},w=c(),h=V=>{console.log(V),n.skuImgUrl=V.imgUrl,k.value.forEach(d=>{w.value.toggleRowSelection(d,!1)}),w.value.toggleRowSelection(V,!0)},x=async()=>{n.skuPlatformAttrList=u.value.reduce((d,p)=>{if(p.skuPlatformAttrIdAndValueId){const[o,g]=p.skuPlatformAttrIdAndValueId.split(":");d.push({attrId:o,valueId:g})}return d},[]),n.skuSalesAttrList=D.value.reduce((d,p)=>{if(p.skuSalesAttrIdAndValueId){const[o,g]=p.skuSalesAttrIdAndValueId.split(":");d.push({attrId:o,valueId:g})}return d},[]),(await we(n)).code===200?(C({type:"success",message:"SKU添加成功"}),b("administrativeNameChange","","update")):C({type:"error",message:"SKU添加失败"})};return _({initAddSkuData:z}),(V,d)=>{const p=se,o=ne,g=ue,q=oe,N=ie,i=Z,r=Y,M=ee;return m(),A(N,{"label-width":"100"},{default:t(()=>[e(o,{label:"SKU名称"},{default:t(()=>[e(p,{placeholder:"SKU名称",modelValue:n.skuName,"onUpdate:modelValue":d[0]||(d[0]=a=>n.skuName=a)},null,8,["modelValue"])]),_:1}),e(o,{label:"价格（元）"},{default:t(()=>[e(p,{placeholder:"价格",type:"number",modelValue:n.skuPrice,"onUpdate:modelValue":d[1]||(d[1]=a=>n.skuPrice=a)},null,8,["modelValue"])]),_:1}),e(o,{label:"重量（g）"},{default:t(()=>[e(p,{placeholder:"重量",type:"number",modelValue:n.skuWeight,"onUpdate:modelValue":d[2]||(d[2]=a=>n.skuWeight=a)},null,8,["modelValue"])]),_:1}),e(o,{label:"SKU描述"},{default:t(()=>[e(p,{placeholder:"描述",type:"textarea",modelValue:n.skuDesc,"onUpdate:modelValue":d[3]||(d[3]=a=>n.skuDesc=a)},null,8,["modelValue"])]),_:1}),e(o,{label:"平台属性"},{default:t(()=>[e(N,{inline:""},{default:t(()=>[(m(!0),B(R,null,T(u.value,a=>(m(),A(o,{key:a.id,label:a.name},{default:t(()=>[e(q,{modelValue:a.skuPlatformAttrIdAndValueId,"onUpdate:modelValue":l=>a.skuPlatformAttrIdAndValueId=l},{default:t(()=>[(m(!0),B(R,null,T(a.attrValueList,l=>(m(),A(g,{key:l.id,label:l.valueName,value:`${a.id}:${l.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(o,{label:"销售属性"},{default:t(()=>[e(N,{inline:""},{default:t(()=>[(m(!0),B(R,null,T(D.value,a=>(m(),A(o,{key:a.id,label:a.attrName},{default:t(()=>[e(q,{modelValue:a.skuSalesAttrIdAndValueId,"onUpdate:modelValue":l=>a.skuSalesAttrIdAndValueId=l},{default:t(()=>[(m(!0),B(R,null,T(a.spuSalesListAttrValueList,l=>(m(),A(g,{key:l.id,label:l.valueName,value:`${a.id}:${l.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(o,{label:"图片名称"},{default:t(()=>[e(M,{border:"",data:k.value,ref_key:"salesPictureTableExamples",ref:w},{default:t(()=>[e(i,{type:"selection",width:"80",align:"center"}),e(i,{label:"图片"},{default:t(({row:a})=>[W("img",{src:E(y)+"/"+a.imgUrl,alt:"品牌图片",style:{width:"100%"}},null,8,Oe)]),_:1}),e(i,{label:"名称",prop:"imgName"}),e(i,{label:"操作"},{default:t(({row:a})=>[e(r,{onClick:l=>h(a)},{default:t(()=>[U("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(o,null,{default:t(()=>[e(r,{type:"primary",onClick:x},{default:t(()=>[U("保存")]),_:1}),e(r,{type:"primary",onClick:j},{default:t(()=>[U("取消")]),_:1})]),_:1})]),_:1})}}}),Re=["src"],Qe=X({__name:"Spu",setup(f){const _=Ve();Ae(()=>{_.$reset()}),Ue(()=>_.classification3Id,i=>{typeof i=="number"&&b()});const b=async(i=1)=>{y.value=i;const r=await $e(y.value,u.value,_.classification3Id);r.code===200&&(n.value=r.data.records,k.value=r.data.total)},y=c(1),j=i=>{b(i)},u=c(3),D=()=>{b()},k=c(0),n=c([]),z=c("spu"),w=(i,r)=>{_.isAddOrEditClassificationData=i,r==="update"?b(y.value):b()},h=c(),x=c(),V=i=>{_.isAddOrEditClassificationData="spu",h.value.initUpdateSpuData(i)},d=()=>{h.value.initAddSpuData(_.classification3Id)},p=i=>{_.isAddOrEditClassificationData="sku",x.value.initAddSkuData(_.classification1Id,_.classification2Id,i)},o=c([]),g=async i=>{const r=await xe(i.id);r.code===200&&(o.value=r.data,N.value=!0)},q=async i=>{(await qe(i.id)).code===200?(C({type:"success",message:"删除成功"}),b(n.value.length>1?y.value:y.value-1)):C({type:"warning",message:"删除失败"})},N=c(!1);return(i,r)=>{const M=Ce,a=Z,l=Le,S=Y,I=De,P=ee,O=he,F=Ne,H=Pe;return m(),B("div",null,[e(M,{administrativeName:z.value,onAddSpu:d},null,8,["administrativeName"]),e(H,{shadow:"always"},{default:t(()=>[J(W("div",null,[e(P,{stripe:"",style:{width:"100%"},data:n.value},{empty:t(()=>[e(l,{name:"commoditymanagement-attr-nodataavailable",width:"100%",height:"100%"}),U(" 暂无数据 ")]),default:t(()=>[e(a,{type:"index",label:"序号",width:"80",center:""}),e(a,{prop:"spuName",label:"SPU名称",width:"100"}),e(a,{label:"SPU描述"},{default:t(({row:v})=>[W("p",null,le(v.description),1)]),_:1}),e(a,{prop:"address",label:"操作",width:"220"},{default:t(({row:v})=>[e(S,{type:"primary",size:"small",title:"添加SKU",plain:"",onClick:$=>p(v)},{default:t(()=>[e(l,{name:"commoditymanagement-spu-add"})]),_:2},1032,["onClick"]),e(S,{type:"primary",size:"small",title:"修改SPU",plain:"",onClick:$=>V(v)},{default:t(()=>[e(l,{name:"commoditymanagement-spu-modification"})]),_:2},1032,["onClick"]),e(S,{type:"primary",size:"small",title:"查看SPU",plain:"",onClick:$=>g(v)},{default:t(()=>[e(l,{name:"commoditymanagement-spu-view"})]),_:2},1032,["onClick"]),e(I,{title:`您确定要删除${v.spuName}吗？`,width:"300px",onConfirm:$=>q(v)},{reference:t(()=>[e(S,{type:"primary",size:"small",title:"删除SPU",plain:""},{default:t(()=>[e(l,{name:"commoditymanagement-spu-delete"})]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(O,{"current-page":y.value,"onUpdate:currentPage":[r[0]||(r[0]=v=>y.value=v),j],"page-size":u.value,"onUpdate:pageSize":[r[1]||(r[1]=v=>u.value=v),D],"page-sizes":[3,5,7,9],background:"",layout:"prev, pager, next, jumper,->,sizes,total",total:k.value},null,8,["current-page","page-size","total"])],512),[[Q,E(_).isAddOrEditClassificationData===""]]),J(e(ze,{ref_key:"editSpuComponentInstance",ref:h,onAdministrativeNameChange:w},null,512),[[Q,E(_).isAddOrEditClassificationData==="spu"]]),J(e(Ke,{ref_key:"editSkuComponentInstance",ref:x,onAdministrativeNameChange:w},null,512),[[Q,E(_).isAddOrEditClassificationData==="sku"]]),e(F,{modelValue:N.value,"onUpdate:modelValue":r[2]||(r[2]=v=>N.value=v),title:"SKU列表","with-header":"",direction:"ltr",size:"50%"},{default:t(()=>[e(P,{border:"",data:o.value},{default:t(()=>[e(a,{label:"SKU名称",prop:"skuName"}),e(a,{label:"SKU价格",prop:"skuPrice"}),e(a,{label:"SKU重量",prop:"skuWeight"}),e(a,{label:"SKU图片"},{default:t(({row:v})=>[W("img",{src:v.skuImgUrl,alt:"SKU图片"},null,8,Re)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Qe as default};
