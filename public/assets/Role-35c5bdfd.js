import{af as _,d as W,B as Y,r,a as Z,o as ee,c as te,b as e,e as a,g as c,A as z,X as I,m as P,q as ae,s as oe,t as le,x as ne,ad as se,ag as ie,ah as re,ai as de,aj as ue,an as ce,ao as pe,ak as me,_ as fe}from"./index-5fcb086d.js";/* empty css                      *//* empty css                        *//* empty css                  */import"./el-tooltip-4ed993c7.js";const _e=(s,i,v)=>_.get(`/role/getall/${s}/${i}/?jobTitle=${v}`),ve=s=>s.id?_.post("/role/update",s):_.post("/role/add",s),ge=s=>_.get(`/role/authority/${s}`),ye=(s,i)=>_.post(`/role/assignauthority/${s}`,i),be=s=>_.get(`/role/delete/${s}`),he={class:"dialog-footer"},ke={class:"dialog-footer"},Ce=W({__name:"Role",setup(s){Y(()=>{p()});const i=r(0),v=r(5),w=r(0),g=r(""),h=r([]),d=Z({name:""}),p=async(n=1)=>{i.value=n;const{code:t,data:o}=await _e(i.value,v.value,g.value);t===200&&(h.value=o.records,w.value=o.total)},D=()=>{p()},j=()=>{p(),g.value=""},J=()=>{p()},m=r(!1),q=()=>{m.value=!0,Object.assign(d,{id:0,name:""}),I(()=>{b.value.clearValidate()})},O=n=>{m.value=!0,Object.assign(d,n),I(()=>{b.value.clearValidate()})},R=async n=>{const{code:t}=await be(n.id);t===200&&(P({type:"success",message:"成功"}),p(h.value.length>1?i.value:i.value-1))},B=async()=>{await b.value.validate();const{code:n}=await ve(d);n===200&&(P({type:"success",message:d.id?"更新成功":"添加成功"}),m.value=!1,p(d.id?i.value:1))},b=r(),F={jobTitle:[{required:!0,trigger:"blur",validator:(n,t,o)=>{d.name.length>=2?o():o(new Error("职位名称至少两位"))}}]},y=r(!1);let E=0;const N=async n=>{y.value=!0,E=n.id;const{code:t,data:o}=await ge(n.id);t===200&&(V.value=o,$(o,T.value))},S={children:"children",label:"name"},V=r([]),T=r([]),$=(n,t)=>{n.forEach(o=>{o.authorityLevel===3&&o.select&&t.push(o.id),o.children&&o.children.length>0&&$(o.children,t)})},k=r(),K=async()=>{const{code:n}=await ye(E,[...k.value.getCheckedKeys(),...k.value.getHalfCheckedKeys()]);n===200&&(P({type:"success",message:"权限分配成功"}),y.value=!1,window.location.reload())};return(n,t)=>{const o=ae,C=oe,u=le,x=ne,A=se,f=ie,M=re,H=de,L=ue,X=ce,G=pe,Q=me;return ee(),te("div",null,[e(A,null,{default:a(()=>[e(x,{inline:"",style:{display:"flex","justify-content":"space-between"}},{default:a(()=>[e(C,null,{default:a(()=>[e(o,{placeholder:"搜索职位",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l)},null,8,["modelValue"])]),_:1}),e(C,null,{default:a(()=>[e(u,{type:"primary",onClick:j,disabled:!g.value},{default:a(()=>[c("搜索")]),_:1},8,["disabled"]),e(u,{type:"primary",onClick:J},{default:a(()=>[c("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{style:{"margin-top":"3vh"}},{default:a(()=>[e(u,{type:"primary",onClick:q},{default:a(()=>[c("添加职位")]),_:1}),e(H,{border:"",style:{"margin-top":"2vh"},data:h.value},{default:a(()=>[e(f,{type:"index",align:"center",label:"#",width:"50"}),e(f,{align:"center",label:"ID",prop:"id",width:"70"}),e(f,{align:"center",label:"职位名称",prop:"name",width:"200"}),e(f,{align:"center",label:"创建时间",prop:"creatTime"}),e(f,{align:"center",label:"更新时间",prop:"updateTime"}),e(f,{align:"center",label:"操作",width:"230"},{default:a(({row:l})=>[e(u,{type:"primary",size:"small",onClick:U=>N(l)},{default:a(()=>[c("设置权限")]),_:2},1032,["onClick"]),e(u,{type:"primary",size:"small",onClick:U=>O(l)},{default:a(()=>[c("编辑")]),_:2},1032,["onClick"]),e(M,{title:`您确定删除${l.name}吗？`,width:"150",onConfirm:U=>R(l)},{reference:a(()=>[e(u,{type:"primary",size:"small"},{default:a(()=>[c("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(L,{"current-page":i.value,"onUpdate:currentPage":[t[1]||(t[1]=l=>i.value=l),p],"page-size":v.value,"onUpdate:pageSize":[t[2]||(t[2]=l=>v.value=l),D],"page-sizes":[5,7,9,11],background:"",layout:"prev, pager, next, jumper,->,sizes,total",total:w.value},null,8,["current-page","page-size","total"])]),_:1}),e(X,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=l=>m.value=l),title:d.id?"更新职位":"添加职位",width:"30%"},{default:a(({})=>[e(x,{model:d,rules:F,ref_key:"addOrUpdatePositionFormRef",ref:b},{default:a(()=>[e(C,{label:"职位",prop:"jobTitle"},{default:a(()=>[e(o,{placeholder:"职位名称",modelValue:d.name,"onUpdate:modelValue":t[3]||(t[3]=l=>d.name=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),footer:a(()=>[z("span",he,[e(u,{onClick:t[4]||(t[4]=l=>m.value=!1)},{default:a(()=>[c("取消")]),_:1}),e(u,{type:"primary",onClick:B},{default:a(()=>[c("确认")]),_:1})])]),_:1},8,["modelValue","title"]),e(Q,{modelValue:y.value,"onUpdate:modelValue":t[7]||(t[7]=l=>y.value=l),title:"分配权限",direction:"ltr"},{default:a(({})=>[e(G,{ref_key:"positionTreeRef",ref:k,data:V.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":T.value,props:S},null,8,["data","default-checked-keys"])]),footer:a(()=>[z("span",ke,[e(u,{onClick:t[6]||(t[6]=l=>y.value=!1)},{default:a(()=>[c("取消")]),_:1}),e(u,{type:"primary",onClick:K},{default:a(()=>[c("确认")]),_:1})])]),_:1},8,["modelValue"])])}}});const xe=fe(Ce,[["__scopeId","data-v-3d76c6e4"]]);export{xe as default};
